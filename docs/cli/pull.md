# fluree pull

Pull commits from upstream and apply them to the local ledger, similar to `git pull`.

## Usage

```bash
fluree pull [LEDGER]
```

## Arguments

| Argument | Description |
|----------|-------------|
| `[LEDGER]` | Ledger name (defaults to active ledger) |

## Description

Downloads new commits from the configured upstream and applies them to the local ledger:

1. Queries the remote for its current head (`t` and commit ContentId)
2. Compares with the local head; exits early if already up to date
3. Attempts bulk download of missing commits via the **pack protocol** (single streaming request)
4. Falls back to paginated JSON export if the server does not support pack
5. Stores all commit and transaction blobs to local CAS
6. Advances the local head to the remote head

### Transport

Pull uses the same pack protocol as clone -- see [clone: Transport](clone.md#transport) for details.

### Origin-based pull

When no upstream remote is configured, pull falls back to **origin-based fetching** if a LedgerConfig with origins is set on the ledger (see `fluree config set-origins`). This uses the same pack-first / CID-walk-fallback transport as `fluree clone --origin`.

This is a **replication** operation. It requires a Bearer token with **root / storage-proxy** permissions (`fluree.storage.*`). If you only have permissioned/query access to a ledger, you should use `fluree track` (or `--remote`) and run queries/transactions against the remote instead.

The ledger must have an upstream configured (see `fluree upstream set`), **or** a LedgerConfig with origins (see `fluree config set-origins`).

**Restart safety:** If interrupted, the local head reflects the last successful import. The next pull resumes from the local head automatically.

## Examples

```bash
# Pull changes for active ledger
fluree pull

# Pull changes for specific ledger
fluree pull mydb
```

## Output

Successful pull:
```
Pulling 'mydb:main' from 'origin' (local t=10, remote t=42)...
✓ 'mydb:main' pulled 32 commit(s) (new head t=42)
```

Already up to date:
```
✓ 'mydb:main' is already up to date
```

No upstream configured:
```
error: no upstream configured for 'mydb:main'
  hint: fluree upstream set mydb:main <remote>
```

## Errors

| Error | Description |
|-------|-------------|
| No upstream configured | Run `fluree upstream set <ledger> <remote>` first, or configure origins via `fluree config set-origins` |
| Ancestry mismatch | Remote chain does not descend from local head (histories diverged) |
| Import validation failure | Commit chain or retraction invariant violation |

## Limitations

- **Graph source indexes not replicated:** Graph source snapshots (BM25/vector/geo, etc.) are not replicated by `fluree pull` yet. Rebuild graph source indexes in the target environment as needed.

## See Also

- [clone](clone.md) - Clone a ledger from a remote server
- [upstream](upstream.md) - Configure upstream tracking
- [fetch](fetch.md) - Fetch refs without modifying local ledger
- [push](push.md) - Push local changes to upstream
